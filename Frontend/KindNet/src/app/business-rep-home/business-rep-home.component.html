<div class="events-list-container">
  <div class="header">
    <h2>Predstojeći i aktivni događaji</h2>
  </div>

  <div *ngIf="loading" class="loading-spinner">
    <mat-spinner></mat-spinner>
    <p>Učitavanje...</p>
  </div>
  <div *ngIf="!loading && events.length === 0" class="no-events">
    <mat-icon>info</mat-icon>
    <p>Trenutno nema događaja koji traže resurse.</p>
  </div>

  <div class="event-list" *ngIf="!loading && events.length > 0">
    <mat-card
      class="event-card"
      *ngFor="let event of events"
      [ngClass]="'type-border-' + event.type.toLowerCase()">

      <div class="card-main-content">
        <div class="event-info">
          <div class="event-title-line">
            <mat-icon class="type-icon">{{ typeIconMapping[event.type] }}</mat-icon>
            <h3 class="event-name">{{ event.name }}</h3>
          </div>
          <div class="event-details">
            <div class="detail-item">
              <mat-icon>location_on</mat-icon>
              <span>{{ event.city }}</span>
            </div>
            <div class="detail-item">
              <mat-icon>schedule</mat-icon>
              <span>{{ event.startTime | date:'dd.MM.yyyy HH:mm' }} - {{ event.endTime | date:'dd.MM.yy HH:mm' }}</span>
            </div>
             <div class="detail-item">
                 <mat-icon>person</mat-icon>
                 <span>Organizator: {{ event.organizerName }}</span>
             </div>
          </div>
        </div>
        <div class="event-meta">
          <div class="tag-and-actions">
            <span class="tag status-tag" [ngClass]="'status-' + event.status.toLowerCase()">
              {{ event.status }}
            </span>
          </div>
          <span class="tag type-tag"  [ngClass]="'tag-'+ event.type.toLowerCase()">
            {{ event.type }}
          </span>
        </div>
      </div>

      <div class="resources-section">
  <div class="resources-list">
    <label class="resources-label">Potrebni resursi</label> <div 
      class="resource-item" 
      *ngFor="let res of event.resourceRequests"
      [ngClass]="'category-border-' + res.category.toString().toLowerCase()"> <div class="resource-main-info">
        <mat-icon class="resource-icon">{{ resourceIconMapping[res.category] }}</mat-icon>
        <div class="resource-name-cat">
          <span class="resource-name">{{ res.itemName }}</span>
          <span class="resource-category">{{ res.category }}</span>
        </div>
      </div>

      <div class="resource-progress">
        <span class="progress-text">
          Obezbijeđeno: <strong>{{ res.quantityFulfilled || 0 }} / {{ res.quantityNeeded }}</strong>
        </span>
        <mat-progress-bar
          mode="determinate"
          [value]="(res.quantityFulfilled || 0) * 100 / res.quantityNeeded">
        </mat-progress-bar>
      </div>

        <div class="resource-action" *ngIf="res.status.toString() !== 'Ispunjen'">
      <button mat-flat-button color="primary" class="offer-button" (click)="openDonationDialog(res)">
        <mat-icon>volunteer_activism</mat-icon>
        <span>Učestvuj</span>
      </button>
    </div>
    </div>
    <div *ngIf="!event.resourceRequests || event.resourceRequests.length === 0" class="no-resources-found">
      <p>Nema traženih resursa za ovaj događaj.</p>
    </div>
  </div>
</div>

    </mat-card>
  </div>
</div>