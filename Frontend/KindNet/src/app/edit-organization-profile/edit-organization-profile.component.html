<div class="edit-profile-container">
  <div *ngIf="isLoading" class="loading-spinner">
    <mat-spinner></mat-spinner>
    <p>Učitavanje profila...</p>
  </div>

  <mat-card class="edit-profile-card" *ngIf="!isLoading">
    <mat-card-header>
      <mat-card-title>{{ isNewProfile ? 'Kreiranje profila organizacije' : 'Ažuriranje profila organizacije' }}</mat-card-title>
      <mat-card-subtitle>
        {{ isNewProfile ? 'Unesite podatke organizacije.' : 'Ažurirajte podatke organizacije.' }}
      </mat-card-subtitle>
    </mat-card-header>
    <mat-divider></mat-divider>

    <mat-card-content>
      <form [formGroup]="profileForm" (ngSubmit)="onSubmit()">
        <div class="form-row">
          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Naziv organizacije</mat-label>
            <input matInput formControlName="name">
            <mat-icon matSuffix>business</mat-icon>
            <mat-error *ngIf="profileForm.get('name')?.hasError('required')">Naziv je obavezan.</mat-error>
          </mat-form-field>
          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Grad</mat-label>
            <input matInput formControlName="city">
            <mat-icon matSuffix>location_city</mat-icon>
            <mat-error *ngIf="profileForm.get('city')?.hasError('required')">Grad je obavezan.</mat-error>
          </mat-form-field>
        </div>

        <mat-form-field appearance="outline" class="full-width-field">
          <mat-label>Opis</mat-label>
          <textarea matInput formControlName="description"></textarea>
          <mat-icon matSuffix>description</mat-icon>
        </mat-form-field>

        <div class="form-row">
          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Kontakt telefon</mat-label>
            <input matInput formControlName="contactPhone">
            <mat-icon matSuffix>phone</mat-icon>
          </mat-form-field>
          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Website</mat-label>
            <input matInput formControlName="website">
            <mat-icon matSuffix>public</mat-icon>
          </mat-form-field>
        </div>

        <div formArrayName="galleryImageUrls" class="section">
            <h4 class="section-title">Galerija</h4>
            <p class="section-subtitle">Dodajte slike koje predstavljaju vašu organizaciju.</p>

            <div class="gallery-previews-container">
                <div *ngFor="let url of galleryArray.controls; let i = index" class="gallery-item-wrapper">
                    <img *ngIf="url.value" [src]="url.value" class="gallery-preview" />
                    <button mat-icon-button color="warn" (click)="removeGalleryUrl(i)" type="button" class="delete-button">
                        <mat-icon>delete</mat-icon>
                    </button>
                </div>
            </div>

            <input type="file" multiple (change)="onFilesSelected($event)" accept="image/*" />
        </div>


        <div class="section">
    <h4 class="section-title">Oblasti aktivnosti</h4>
    <p class="section-subtitle">Izaberite oblasti u kojima vaša organizacija djeluje.</p>

    <mat-checkbox *ngFor="let area of predefinedAreas"
                  [checked]="activityArray.value.includes(area)"
                  (change)="toggleActivityArea(area)">
        {{ area }}
    </mat-checkbox>
    
    <mat-form-field appearance="outline" class="full-width-field custom-area-field">
        <mat-label>Dodajte drugu oblast</mat-label>
        <input matInput [(ngModel)]="customActivityArea" [ngModelOptions]="{standalone: true}" (keyup.enter)="addCustomActivityArea()">
        <mat-icon matSuffix (click)="addCustomActivityArea()">add</mat-icon>
    </mat-form-field>

    <mat-chip-listbox aria-label="Selected activity areas">
        <mat-chip *ngFor="let area of activityArray.controls; let i = index"
                  (removed)="removeActivityArea(i)"
                  [removable]="true">
            {{ area.value }}
            <mat-icon matChipRemove>cancel</mat-icon>
        </mat-chip>
    </mat-chip-listbox>
</div>

        <div class="form-actions">
          <button mat-raised-button color="primary" type="submit" >
            <mat-icon>save</mat-icon> Sačuvaj profil
          </button>
          <button mat-button type="button" [routerLink]="['/layout/user-profile']">Odustani</button>
        </div>
      </form>
    </mat-card-content>
  </mat-card>
</div>
